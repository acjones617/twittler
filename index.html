<!DOCTYPE html>
<html>
  <head profile>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="jquery.reveal.js" type="text/javascript"></script>
    <script src="underscore.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="twittler_style.css">
    <link rel="stylesheet" href="reveal.css">

    <title>Twittler</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
  </head>
  <body>
    <script>

      /*
      Requirements:

      Show the user new tweets somehow. (You can show them automatically as they're created, or create a button that displays new tweets.)
      Display the timestamps of when the tweets were created.
      Design your interface so that you want to look at and use the product you're making.
      Allow the user to click on a username to see that user's timeline.
      */

      /*
      Data generator does :

      Creates two global variables, users and streams.
        users is an array of strings -- all the usernames that you're following.
        streams is an object with two properties, users and home.
          streams.home is an array of all tweets from all the users you're following.
          streams.users is an object with properties for each user. streams.users.shawndrost has all of shawndrost's tweets.
      */

      $(document).ready(function(){
//       var $body = $('body');
//       $body.html('');

        var visibleTweets = [];

        var addTweets = function (){
          var index = 0;
          while(index < streams.home.length){
            var tweet = streams.home[index];
            if (visibleTweets.indexOf(tweet.created_at) == -1){
              var $tweet = $("<div class='center oldT'></div>");
              var $tweetTime = tweet.created_at // Change date format later
              $tweet.html('@' + '<a href="#" data-reveal-id="myModal" class="tweeterClick ' + tweet.user + '">'+tweet.user+'</a>' + ': ' + $tweetTime + '<br/>' + tweet.message);
              $tweet.insertAfter($('button'));  

              // New Tweets start as hidden, fade in over course of 1 second. Change to highlighted at first and then fade in?
              $tweet.fadeIn(1000);
              visibleTweets.push(tweet.created_at);
            }
            index += 1;
          }
          //$(.newT).animate({'border-style': 'none', 'border-top-style': 'solid', 'border-color': 'black', 'background-color': 'rgba(163, 250, 246, 0.09)'});

        }
        
        // Screen opens with 10 tweets from data_generator.js
        addTweets();

        // Every 3 seconds, check to see if new tweets have been written
        setInterval(function () {
            var newTweets = 0;
            var index = 0;
            while (index < streams.home.length) {
              var tweet = streams.home[index];
              if (visibleTweets.indexOf(tweet.created_at) == -1) {
                newTweets += 1;
              }
              index += 1;
            }
            if (newTweets === 1) {
              $('button').html('Fresh tweets: 1 new tweet available');
            } else if (newTweets > 1) {
              $('button').html('Fresh tweets: ' + newTweets + ' new tweets available');
            }
            if (newTweets >= 1) {
              $('title').html('(' + newTweets + ') Twittler');
            }

          }, 3000);

        // If Fresh Tweets button clicked, add new tweets, reset button and title text.
        $('button').on('click', function() {
          addTweets();
          $('button').html('0 new tweets available');
          $('title').html('Twittler');
        });


        // If someone clicks tweet user, then bring up modal showing that user's tweets
        //Options for myModal;

        var tweetUsers = _.keys(streams.users)

        var userTweets = function (thisUser){
          _.each(streams.users[thisUser], function (tweetObj){
            var $tweet = $("<div class='oldT'></div>");
            var $tweetTime = tweetObj.created_at; // Change date format later
            $tweet.html('@' + tweetObj.user + ': ' + $tweetTime + '<br/>' + tweetObj.message);
            $tweet.insertAfter($('.tweeter').find('h1'));
            $tweet.show();
          });
        }

        _.each(tweetUsers, function (user) {
          $('.'+user).click(function () {
            $('#myModal').reveal({
              animation: 'fadeAndPop',                   //fade, fadeAndPop, none
              animationspeed: 300,                       //how fast animtions are
              closeonbackgroundclick: true,              //if you click background will modal close?
              dismissmodalclass: 'close-reveal-modal'    //the class of a button or element that will close an open modal
            });
            
            $('.tweeter').find('h1').text('@'+user);
            $('.tweeter').find('.oldT').remove();
            userTweets(user);
          });
        })

      });

    </script>

    <div class="refresh">
      <button type='button' class='center'>0 new tweets available</button>
    </div>

    <div id="myModal" class="reveal-modal tweeter">
      <h1>Modal Tweets</h1>
      <a class="close-reveal-modal">&#215;</a>
    </div>


  </body>
</html>
