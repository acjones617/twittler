<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="twittler_style.css">
    

    <title>Twittler</title>
  </head>
  <body>
    <script>

      /*
      Requirements:

      Show the user new tweets somehow. (You can show them automatically as they're created, or create a button that displays new tweets.)
      Display the timestamps of when the tweets were created.
      Design your interface so that you want to look at and use the product you're making.
      Allow the user to click on a username to see that user's timeline.
      */

      /*
      Data generator does :

      Creates two global variables, users and streams.
        users is an array of strings -- all the usernames that you're following.
        streams is an object with two properties, users and home.
          streams.home is an array of all tweets from all the users you're following.
          streams.users is an object with properties for each user. streams.users.shawndrost has all of shawndrost's tweets.
      */

      $(document).ready(function(){
        var $body = $('body');
        $body.html('');

        var visibleTweets = [];

        var $button = $("<button type='button' class='refresh'>Refresh tweets: 0 new tweets available</button>");
        $button.prependTo($('body'));

        var addTweets = function (){
          var index = 0;
          while(index < streams.home.length){
            var tweet = streams.home[index];
            var $tweet = $('<div></div>');
            $tweet.text(tweet.created_at + '@' + tweet.user + ': ' + tweet.message);
            if (visibleTweets.indexOf(tweet.created_at) == -1){
              $tweet.insertAfter($button);  
            }
            visibleTweets.push(tweet.created_at);
            index += 1;
          } 
        }
        
        addTweets();

        $('button').on('click', function() {
          addTweets();
          $('button').html('Refresh tweets: 0 new tweets available.');
          $('title').html('Twittler');
        });

        setInterval(function () {
            var newTweets = 0;
            var index = 0;
            while (index < streams.home.length) {
              var tweet = streams.home[index];
              if (visibleTweets.indexOf(tweet.created_at) == -1) {
                newTweets += 1;
              }
              index += 1;
            }
            if (newTweets === 1) {
              $('.refresh').html('Refresh tweets: 1 new tweet available.');
            } else {
              $('.refresh').html('Refresh tweets: ' + newTweets + ' new tweets available');
            }
            if (newTweets >= 1) {
              $('title').html('(' + newTweets + ') Twittler');
            }

          }, 3000);

      });

    </script>
  </body>
</html>
